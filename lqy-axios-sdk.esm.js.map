{"version":3,"file":"lqy-axios-sdk.esm.js","sources":["../src/factory/decoratorFactory.ts","../src/decorator/index.ts","../src/index.ts"],"sourcesContent":["/**\r\n * requestMethod 请求装饰器工厂\r\n * @param {string} url 请求地址\r\n * @param {string} method 请求类型\r\n */\r\nexport function requestMethod(url:string,method:string){\r\n    return function (target,name,descriptor){\r\n        const original = descriptor.value;\r\n        descriptor.value = function (arg,additionalParam = {}){\r\n            arg.method = method;\r\n            arg.url = url;\r\n            try{\r\n                return original.apply(this,[arg,additionalParam])\r\n            }catch (e){\r\n                console.log(e);\r\n                console.error(`${method} 装饰器报错`)\r\n            }\r\n        }\r\n        return descriptor;\r\n    }\r\n}","import {requestMethod} from '../factory/decoratorFactory';\r\nconst qs = require('qs');\r\n/**\r\n * GET\r\n * @param {string} url 接口地址\r\n * @param {string} explain 接口备注\r\n */\r\nfunction GET(url:string,explain?:string) {\r\n    return requestMethod(url,'get');\r\n}\r\n/**\r\n * POST\r\n * @param {string} url 接口地址\r\n * @param {string} explain 接口备注\r\n */\r\nfunction POST(url:string,explain?:string) {\r\n    return requestMethod(url,'post');\r\n}\r\n/**\r\n * PUT\r\n * @param {string} url 接口地址\r\n * @param {string} explain 接口备注\r\n */\r\nfunction PUT(url:string,explain?:string) {\r\n    return requestMethod(url,'put');\r\n}\r\n/**\r\n * DELETE\r\n * @param {string} url 接口地址\r\n * @param {string} explain 接口备注\r\n */\r\nfunction DELETE(url:string,explain?:string) {\r\n    return requestMethod(url,'delete');\r\n}\r\n/**\r\n * UrlParam\r\n */\r\nfunction UrlParam(target,name,descriptor){\r\n    const original = descriptor.value;\r\n    descriptor.value = function (...arg){\r\n        try{\r\n            arg[0].url = `${arg[0].url}/${arg[1].join('/')}`;\r\n            return original.apply(this,[...arg])\r\n        }catch (e){\r\n            console.error(`requestUrlParam-${arg[1].join('/')} 装饰器报错`)\r\n        }\r\n    }\r\n    return descriptor;\r\n}\r\n/**\r\n * QS\r\n */\r\nfunction QS(target,name,descriptor) {\r\n    const original = descriptor.value;\r\n    descriptor.value = function (...arg){\r\n        try{\r\n            arg[0].data = qs.stringify(arg[0].data);\r\n            return original.apply(this,[...arg])\r\n        }catch (e){\r\n            console.error(`QS 装饰器报错`,e,qs)\r\n        }\r\n    }\r\n    return descriptor;\r\n}\r\n/**\r\n * 导出请求装饰器\r\n */\r\nexport default {\r\n    GET,POST,PUT,DELETE,UrlParam,QS\r\n}","\r\n/**\r\n * axios 实例封装\r\n */\r\nimport axios from 'axios';\r\nimport {requestParams} from './interface/lqyRequest';\r\nimport {axiosConfig,lqyAxiosConfig} from './interface/lqyAxios'\r\nimport decorator from './decorator/index';\r\nexport const {GET} = decorator;\r\nexport const {POST} = decorator;\r\nexport const {PUT} = decorator;\r\nexport const {DELETE} = decorator;\r\nexport const {UrlParam} = decorator;\r\nexport const {QS} = decorator;\r\n\r\nclass HttpRequest {\r\n    private Axios = null;\r\n    constructor(public axiosConfig: axiosConfig, public lqyAxiosConfig?: lqyAxiosConfig) {\r\n        this.lqyAxiosConfig = lqyAxiosConfig;\r\n        this.axiosConfig = axiosConfig;\r\n        this.init();\r\n    }\r\n    /**\r\n     * init 初始化方法\r\n     */\r\n    init() {\r\n        this.Axios = axios.create({\r\n            baseURL: this.axiosConfig.baseURL,\r\n            timeout: this.axiosConfig.timeout,\r\n            headers: this.axiosConfig.headers\r\n        });\r\n        this.initInterceptorsResponse(this.Axios);\r\n        this.initInterceptorsRequest(this.Axios);\r\n        this.lqyAxiosConfig?.validateStatus && this.initValidateStatus(this.Axios,this.lqyAxiosConfig.validateStatus.validateStatusFn);\r\n        this.lqyAxiosConfig?.beforeInterceptorsRequestHook && (this.Axios.defaults.beforeInterceptorsRequestHook = this.lqyAxiosConfig.beforeInterceptorsRequestHook);\r\n        this.lqyAxiosConfig?.beforeInterceptorsResponseHook && (this.Axios.defaults.beforeInterceptorsResponseHook = this.lqyAxiosConfig.beforeInterceptorsResponseHook);\r\n        this.lqyAxiosConfig?.afterInterceptorsRequestHook && (this.Axios.defaults.afterInterceptorsRequestHook = this.lqyAxiosConfig.afterInterceptorsRequestHook);\r\n        this.lqyAxiosConfig?.afterInterceptorsResponseHook && (this.Axios.defaults.afterInterceptorsResponseHook = this.lqyAxiosConfig.afterInterceptorsResponseHook);\r\n    }\r\n    /**\r\n     * initInterceptorsResponse 响应器注册\r\n     * @param {axios} axios 实例\r\n     */\r\n    initInterceptorsResponse(axios) {\r\n        axios.interceptors.response.use(\r\n            async (config) => {\r\n                if(axios?.defaults?.beforeInterceptorsRequestHook){\r\n                   await axios?.defaults?.beforeInterceptorsResponseHook(config);\r\n                }\r\n                if(axios?.defaults?.afterInterceptorsRequestHook){\r\n                    Promise.resolve().then(()=>{\r\n                        axios?.defaults?.afterInterceptorsResponseHook(config);\r\n                    })\r\n                }\r\n                return config;\r\n            },\r\n            (err) => {\r\n                Promise.reject(err);\r\n            }\r\n        );\r\n    }\r\n    /**\r\n     * initInterceptorsRequest 拦截器注册\r\n     * @param {axios} axios 实例\r\n     */\r\n    initInterceptorsRequest(axios) {\r\n        axios.interceptors.request.use(\r\n            async (config) => {\r\n                // 携带上token\r\n                // const token = localStorage.getItem('token') || ''\r\n                // token && (config.headers.Authorization = token)\r\n                if(axios?.defaults?.beforeInterceptorsResponseHook){\r\n                    await axios?.defaults?.beforeInterceptorsRequestHook(config);\r\n                }\r\n                if(axios?.defaults?.afterInterceptorsRequestHook){\r\n                    Promise.resolve().then(()=>{\r\n                        axios?.defaults?.afterInterceptorsRequestHook(config);\r\n                    })\r\n                }\r\n                return config;\r\n            },\r\n            (err) => {\r\n                Promise.reject(err);\r\n            }\r\n        );\r\n    }\r\n    /**\r\n     * initValidateStatus 拦截器注册\r\n     * @param {axios} axios 实例\r\n     * @param {Function} fn 自定义 HTTP 状态码判断\r\n     * @return {boolean} true 表示 成功 ，false 表示失败\r\n     */\r\n    initValidateStatus(axios,fn){\r\n        axios.defaults.validateStatus = status => {\r\n            return (status) => fn();\r\n        }\r\n    }\r\n    /**\r\n     * lqyRequest 统一请求\r\n     * @param {param} param 请求参数及配置\r\n     * @return {Promise} 返回 Promise 对象\r\n     */\r\n    lqyRequest(param: requestParams) {\r\n        return new Promise((resolve, reject) => {\r\n            this.Axios(param)\r\n                .then((res) => {\r\n                    resolve(res);\r\n                })\r\n                .catch((err) => {\r\n                    reject(err);\r\n                });\r\n        });\r\n    }\r\n}\r\n\r\nexport default HttpRequest;"],"names":["requestMethod","url","method","target","name","descriptor","original","value","arg","additionalParam","apply","this","e","console","log","error","qs","require","GET","explain","POST","PUT","DELETE","UrlParam","join","QS","data","stringify","HttpRequest","axiosConfig","lqyAxiosConfig","Axios","init","axios","create","baseURL","timeout","headers","initInterceptorsResponse","initInterceptorsRequest","validateStatus","initValidateStatus","validateStatusFn","beforeInterceptorsRequestHook","defaults","beforeInterceptorsResponseHook","afterInterceptorsRequestHook","afterInterceptorsResponseHook","interceptors","response","use","config","_axios$defaults","Promise","resolve","then","_axios$defaults3","_axios$defaults4","err","reject","request","_axios$defaults5","_axios$defaults7","_axios$defaults8","fn","status","lqyRequest","param","_this","res"],"mappings":"8BAKgBA,EAAcC,EAAWC,GACrC,gBAAiBC,EAAOC,EAAKC,GACzB,IAAMC,EAAWD,EAAWE,MAW5B,OAVAF,EAAWE,MAAQ,SAAUC,EAAIC,YAAAA,IAAAA,EAAkB,IAC/CD,EAAIN,OAASA,EACbM,EAAIP,IAAMA,EACV,IACI,OAAOK,EAASI,MAAMC,KAAK,CAACH,EAAIC,IACnC,MAAOG,GACJC,QAAQC,IAAIF,GACZC,QAAQE,MAASb,cAGlBG,GCjBf,IAAMW,EAAKC,QAAQ,MCOLC,EDDd,SAAajB,EAAWkB,GACpB,OAAOnB,EAAcC,EAAI,QCCfmB,EDMd,SAAcnB,EAAWkB,GACrB,OAAOnB,EAAcC,EAAI,SCNfoB,EDad,SAAapB,EAAWkB,GACpB,OAAOnB,EAAcC,EAAI,QCbfqB,EDoBd,SAAgBrB,EAAWkB,GACvB,OAAOnB,EAAcC,EAAI,WCpBfsB,EDyBd,SAAkBpB,EAAOC,EAAKC,GAC1B,IAAMC,EAAWD,EAAWE,MAS5B,OARAF,EAAWE,MAAQ,eAAaC,2BAC5B,IAEI,OADAA,EAAI,GAAGP,IAASO,EAAI,GAAGP,QAAOO,EAAI,GAAGgB,KAAK,KACnClB,EAASI,MAAMC,eAASH,IAClC,MAAOI,GACJC,QAAQE,yBAAyBP,EAAI,GAAGgB,KAAK,iBAG9CnB,GClCGoB,EDuCd,SAAYtB,EAAOC,EAAKC,GACpB,IAAMC,EAAWD,EAAWE,MAS5B,OARAF,EAAWE,MAAQ,eAAaC,2BAC5B,IAEI,OADAA,EAAI,GAAGkB,KAAOV,EAAGW,UAAUnB,EAAI,GAAGkB,MAC3BpB,EAASI,MAAMC,eAASH,IAClC,MAAOI,GACJC,QAAQE,iBAAiBH,EAAEI,KAG5BX,GC/CLuB,aAEF,WAAmBC,EAAiCC,QAAjCD,wBAAiCC,2BAD5CC,MAAQ,KACGpB,iBAAAkB,EAAiClB,oBAAAmB,EAChDnB,KAAKmB,eAAiBA,EACtBnB,KAAKkB,YAAcA,EACnBlB,KAAKqB,kCAKTA,KAAA,yBACIrB,KAAKoB,MAAQE,EAAMC,OAAO,CACtBC,QAASxB,KAAKkB,YAAYM,QAC1BC,QAASzB,KAAKkB,YAAYO,QAC1BC,QAAS1B,KAAKkB,YAAYQ,UAE9B1B,KAAK2B,yBAAyB3B,KAAKoB,OACnCpB,KAAK4B,wBAAwB5B,KAAKoB,sBAC7BD,yBAAgBU,iBAAkB7B,KAAK8B,mBAAmB9B,KAAKoB,MAAMpB,KAAKmB,eAAeU,eAAeE,iCACxGZ,yBAAgBa,iCAAkChC,KAAKoB,MAAMa,SAASD,8BAAgChC,KAAKmB,eAAea,8CAC1Hb,yBAAgBe,kCAAmClC,KAAKoB,MAAMa,SAASC,+BAAiClC,KAAKmB,eAAee,+CAC5Hf,yBAAgBgB,gCAAiCnC,KAAKoB,MAAMa,SAASE,6BAA+BnC,KAAKmB,eAAegB,6CACxHhB,yBAAgBiB,iCAAkCpC,KAAKoB,MAAMa,SAASG,8BAAgCpC,KAAKmB,eAAeiB,kCAMnIT,yBAAA,SAAyBL,GACrBA,EAAMe,aAAaC,SAASC,aACjBC,8BASH,aALGlB,YAAAA,EAAOW,WAAPQ,EAAiBN,8BAChBO,QAAQC,UAAUC,KAAK,uBACnBtB,YAAAA,EAAOW,aAAUG,8BAA8BI,KAGhDA,iCARJlB,YAAAA,EAAOW,WAAPY,EAAiBb,2DACXV,YAAAA,EAAOW,iBAAPa,EAAiBZ,+BAA+BM,0EAHjE,oCAYI,SAACO,GACGL,QAAQM,OAAOD,QAQ3BnB,wBAAA,SAAwBN,GACpBA,EAAMe,aAAaY,QAAQV,aAChBC,8BAYH,aALGlB,YAAAA,EAAOW,WAAPiB,EAAiBf,8BAChBO,QAAQC,UAAUC,KAAK,uBACnBtB,YAAAA,EAAOW,aAAUE,6BAA6BK,KAG/CA,iCARJlB,YAAAA,EAAOW,WAAPkB,EAAiBjB,4DACVZ,YAAAA,EAAOW,iBAAPmB,EAAiBpB,8BAA8BQ,0EANjE,oCAeI,SAACO,GACGL,QAAQM,OAAOD,QAU3BjB,mBAAA,SAAmBR,EAAM+B,GACrB/B,EAAMW,SAASJ,eAAiB,SAAAyB,GAC5B,gBAAQA,UAAWD,SAQ3BE,WAAA,SAAWC,cACP,WAAWd,QAAQ,SAACC,EAASK,GACzBS,EAAKrC,MAAMoC,GACNZ,KAAK,SAACc,GACHf,EAAQe,WAEL,SAACX,GACJC,EAAOD"}