{"version":3,"file":"lqy-axios-sdk.modern.js","sources":["../src/factory/decoratorFactory.ts","../src/decorator/index.ts","../src/index.ts"],"sourcesContent":["/**\r\n * requestMethod 请求装饰器工厂\r\n * @param {string} url 请求地址\r\n * @param {string} method 请求类型\r\n */\r\nexport function requestMethod(url:string,method:string){\r\n    return function (target,name,descriptor){\r\n        const original = descriptor.value;\r\n        descriptor.value = function (arg,additionalParam = {}){\r\n            arg.method = method;\r\n            arg.url = url;\r\n            try{\r\n                return original.apply(this,[arg,additionalParam])\r\n            }catch (e){\r\n                console.log(e);\r\n                console.error(`${method} 装饰器报错`)\r\n            }\r\n        }\r\n        return descriptor;\r\n    }\r\n}","import {requestMethod} from '../factory/decoratorFactory';\r\nconst qs = require('qs');\r\n/**\r\n * GET\r\n * @param {string} url 接口地址\r\n * @param {string} explain 接口备注\r\n */\r\nfunction GET(url:string,explain?:string) {\r\n    return requestMethod(url,'get');\r\n}\r\n/**\r\n * POST\r\n * @param {string} url 接口地址\r\n * @param {string} explain 接口备注\r\n */\r\nfunction POST(url:string,explain?:string) {\r\n    return requestMethod(url,'post');\r\n}\r\n/**\r\n * PUT\r\n * @param {string} url 接口地址\r\n * @param {string} explain 接口备注\r\n */\r\nfunction PUT(url:string,explain?:string) {\r\n    return requestMethod(url,'put');\r\n}\r\n/**\r\n * DELETE\r\n * @param {string} url 接口地址\r\n * @param {string} explain 接口备注\r\n */\r\nfunction DELETE(url:string,explain?:string) {\r\n    return requestMethod(url,'delete');\r\n}\r\n/**\r\n * UrlParam\r\n */\r\nfunction UrlParam(target,name,descriptor){\r\n    const original = descriptor.value;\r\n    descriptor.value = function (...arg){\r\n        try{\r\n            arg[0].url = `${arg[0].url}/${arg[1].join('/')}`;\r\n            return original.apply(this,[...arg])\r\n        }catch (e){\r\n            console.error(`requestUrlParam-${arg[1].join('/')} 装饰器报错`)\r\n        }\r\n    }\r\n    return descriptor;\r\n}\r\n/**\r\n * QS\r\n */\r\nfunction QS(target,name,descriptor) {\r\n    const original = descriptor.value;\r\n    descriptor.value = function (...arg){\r\n        try{\r\n            arg[0].data = qs.stringify(arg[0].data);\r\n            return original.apply(this,[...arg])\r\n        }catch (e){\r\n            console.error(`QS 装饰器报错`,e,qs)\r\n        }\r\n    }\r\n    return descriptor;\r\n}\r\n/**\r\n * 导出请求装饰器\r\n */\r\nexport default {\r\n    GET,POST,PUT,DELETE,UrlParam,QS\r\n}","\r\n/**\r\n * axios 实例封装\r\n */\r\nimport axios from 'axios';\r\nimport {requestParams} from './interface/lqyRequest';\r\nimport {axiosConfig,lqyAxiosConfig} from './interface/lqyAxios'\r\nimport decorator from './decorator/index';\r\nexport const {GET} = decorator;\r\nexport const {POST} = decorator;\r\nexport const {PUT} = decorator;\r\nexport const {DELETE} = decorator;\r\nexport const {UrlParam} = decorator;\r\nexport const {QS} = decorator;\r\n\r\nclass HttpRequest {\r\n    private Axios = null;\r\n    constructor(public axiosConfig: axiosConfig, public lqyAxiosConfig?: lqyAxiosConfig) {\r\n        this.lqyAxiosConfig = lqyAxiosConfig;\r\n        this.axiosConfig = axiosConfig;\r\n        this.init();\r\n    }\r\n    /**\r\n     * init 初始化方法\r\n     */\r\n    init() {\r\n        this.Axios = axios.create({\r\n            baseURL: this.axiosConfig.baseURL,\r\n            timeout: this.axiosConfig.timeout,\r\n            headers: this.axiosConfig.headers\r\n        });\r\n        this.initInterceptorsResponse(this.Axios);\r\n        this.initInterceptorsRequest(this.Axios);\r\n        this.lqyAxiosConfig?.validateStatus && this.initValidateStatus(this.Axios,this.lqyAxiosConfig.validateStatus.validateStatusFn);\r\n        this.lqyAxiosConfig?.beforeInterceptorsRequestHook && (this.Axios.defaults.beforeInterceptorsRequestHook = this.lqyAxiosConfig.beforeInterceptorsRequestHook);\r\n        this.lqyAxiosConfig?.beforeInterceptorsResponseHook && (this.Axios.defaults.beforeInterceptorsResponseHook = this.lqyAxiosConfig.beforeInterceptorsResponseHook);\r\n        this.lqyAxiosConfig?.afterInterceptorsRequestHook && (this.Axios.defaults.afterInterceptorsRequestHook = this.lqyAxiosConfig.afterInterceptorsRequestHook);\r\n        this.lqyAxiosConfig?.afterInterceptorsResponseHook && (this.Axios.defaults.afterInterceptorsResponseHook = this.lqyAxiosConfig.afterInterceptorsResponseHook);\r\n    }\r\n    /**\r\n     * initInterceptorsResponse 响应器注册\r\n     * @param {axios} axios 实例\r\n     */\r\n    initInterceptorsResponse(axios) {\r\n        axios.interceptors.response.use(\r\n            async (config) => {\r\n                if(axios?.defaults?.beforeInterceptorsRequestHook){\r\n                   await axios?.defaults?.beforeInterceptorsResponseHook(config);\r\n                }\r\n                if(axios?.defaults?.afterInterceptorsRequestHook){\r\n                    Promise.resolve().then(()=>{\r\n                        axios?.defaults?.afterInterceptorsResponseHook(config);\r\n                    })\r\n                }\r\n                return config;\r\n            },\r\n            (err) => {\r\n                Promise.reject(err);\r\n            }\r\n        );\r\n    }\r\n    /**\r\n     * initInterceptorsRequest 拦截器注册\r\n     * @param {axios} axios 实例\r\n     */\r\n    initInterceptorsRequest(axios) {\r\n        axios.interceptors.request.use(\r\n            async (config) => {\r\n                // 携带上token\r\n                // const token = localStorage.getItem('token') || ''\r\n                // token && (config.headers.Authorization = token)\r\n                if(axios?.defaults?.beforeInterceptorsResponseHook){\r\n                    await axios?.defaults?.beforeInterceptorsRequestHook(config);\r\n                }\r\n                if(axios?.defaults?.afterInterceptorsRequestHook){\r\n                    Promise.resolve().then(()=>{\r\n                        axios?.defaults?.afterInterceptorsRequestHook(config);\r\n                    })\r\n                }\r\n                return config;\r\n            },\r\n            (err) => {\r\n                Promise.reject(err);\r\n            }\r\n        );\r\n    }\r\n    /**\r\n     * initValidateStatus 拦截器注册\r\n     * @param {axios} axios 实例\r\n     * @param {Function} fn 自定义 HTTP 状态码判断\r\n     * @return {boolean} true 表示 成功 ，false 表示失败\r\n     */\r\n    initValidateStatus(axios,fn){\r\n        axios.defaults.validateStatus = status => {\r\n            return (status) => fn();\r\n        }\r\n    }\r\n    /**\r\n     * lqyRequest 统一请求\r\n     * @param {param} param 请求参数及配置\r\n     * @return {Promise} 返回 Promise 对象\r\n     */\r\n    lqyRequest(param: requestParams) {\r\n        return new Promise((resolve, reject) => {\r\n            this.Axios(param)\r\n                .then((res) => {\r\n                    resolve(res);\r\n                })\r\n                .catch((err) => {\r\n                    reject(err);\r\n                });\r\n        });\r\n    }\r\n}\r\n\r\nexport default HttpRequest;"],"names":["requestMethod","url","method","target","name","descriptor","original","value","arg","additionalParam","apply","this","e","console","log","error","qs","require","explain","join","data","stringify","GET","decorator","POST","PUT","DELETE","UrlParam","QS","constructor","axiosConfig","lqyAxiosConfig","Axios","init","axios","create","baseURL","timeout","headers","initInterceptorsResponse","initInterceptorsRequest","validateStatus","initValidateStatus","validateStatusFn","beforeInterceptorsRequestHook","defaults","beforeInterceptorsResponseHook","afterInterceptorsRequestHook","afterInterceptorsResponseHook","interceptors","response","use","async","config","_axios$defaults","_axios$defaults2","_axios$defaults3","Promise","resolve","then","err","reject","request","_axios$defaults5","_axios$defaults6","_axios$defaults7","fn","status","lqyRequest","param","res","catch"],"mappings":"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"}